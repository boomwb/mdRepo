```
第一次运行docker环境

sudo docker run -it --name luckfox -v /home/ubuntu/luckfox-pico:/home luckfoxtech/luckfox_pico:1.0 /bin/bash

第二次运行docker环境

sudo docker start -ai luckfox


```









```
Luckfox-Pico-Plus/Pro/Max 连接设备由门开机后，设备总是发送 udhcpc:sending discover。
答:网口未连接网线就会打印日志udhcpc:sending discover，解决办法连接网线或者使用命令杀死进程。
ps | grep udhcpc
//248 root1196 5udhcpc -i ethe
//311 root

kill 248
//udhcpc: received SIGTERM


解压
tar -zxvf pro.tar.gz -C /home/wwwroot/project


sudo apt update && sudo apt upgrade
sudo apt install clang
clang --version


insmod
modinfo

```



# 引脚图

![image-20231221134924957](G:\JianYun\我的坚果云\Typora_Work\Typora_Pic\image-20231221134924957.png)

```
GPIO1_C7_d

引脚编号为 1*32+(2*8+7) = 55
```

设备树:

```
# Kernel dts
export RK_KERNEL_DTS=rv1106g-luckfox-pico-pro-max.dts
设备树文件路径如下：
<SDK目录>/sysdrv/source/kernel/arch/arm/boot/dts/

~/luckfox-pico/sysdrv/source/kernel/arch/arm/boot/dts$ cat rv1106g-luckfox-pico-pro-max.dts
// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright (c) 2022 Rockchip Electronics Co., Ltd.
 */

/dts-v1/;

#include "rv1106.dtsi"
#include "rv1106-evb.dtsi"
#include "rv1106-luckfox-pico-pro-max-ipc.dtsi"

/ {
	model = "Luckfox Pico Max";
	compatible = "rockchip,rv1103g-38x38-ipc-v10", "rockchip,rv1106";
};



/**********FLASH**********/
&sfc {
	status = "okay";
	flash@0 {
		compatible = "spi-nand";
		reg = <0>;
		spi-max-frequency = <75000000>;
		spi-rx-bus-width = <4>;
		spi-tx-bus-width = <1>;
	};
	
};

/**********SDMMC**********/
&sdmmc {
	max-frequency = <50000000>;
	no-sdio;
	no-mmc;
	bus-width = <4>;
	cap-mmc-highspeed;
	cap-sd-highspeed;
	disable-wp;
	pinctrl-names = "default";
	pinctrl-0 = <&sdmmc0_clk &sdmmc0_cmd &sdmmc0_det &sdmmc0_bus4>;
	status = "okay";
};

/**********SDIO**********/
// &sdio {
// 	max-frequency = <50000000>;
// 	no-sdio;
// 	no-mmc;
// 	bus-width = <4>;
// 	cap-mmc-highspeed;
// 	cap-sd-highspeed;
// 	disable-wp;
// 	pinctrl-names = "default";
// 	pinctrl-0 = <&sdmmc1m0_cmd &sdmmc1m0_clk &sdmmc1m0_bus4 &clk_32k>;
// 	status = "okay";
// };

/**********ETH**********/
&gmac {
	status = "okay";
};

/**********USB**********/
&usbdrd_dwc3 {
	status = "okay";
	dr_mode = "peripheral";
};

/**********I2C**********/
// &i2c1 {
// 	status = "okay";
// 	pinctrl-0 = <&i2c1m1_xfer>;
// 	clock-frequency = <100000>;
// };
&i2c3 {
	status = "okay";
	pinctrl-0 = <&i2c3m1_xfer>;
	clock-frequency = <100000>;
};

// /**********SPI**********/
&spi0 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&spi0m0_pins>;
	cs-gpios = <&gpio1 RK_PC0 1>;
	// cs-gpios = <&gpio1 26 1>;
	#address-cells = <1>;
	#size-cells = <0>;
	spidev@0 {
		compatible = "rockchip,spidev";
		spi-max-frequency = <50000000>;
		reg = <0>;
	};
};



/**********UART**********/

// &uart0 {
// 	status = "okay";
// 	pinctrl-names = "default";
// 	pinctrl-0 = <&uart0m1_xfer>;
// };

// &uart1 {
// 	status = "okay";
// 	pinctrl-names = "default";
// 	pinctrl-0 = <&uart1m1_xfer>;
// };

&uart3 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&uart3m1_xfer>;
};
&uart4 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&uart4m1_xfer>;
};


// /**********PWM**********/

// &pwm0 {
// 	status = "okay";
// 	pinctrl-names = "active";
// 	pinctrl-0 = <&pwm0m0_pins>;
// 	// pinctrl-0 = <&pwm0m1_pins>;
// };
// &pwm1 {
// 	status = "okay";
// 	pinctrl-names = "active";
// 	pinctrl-0 = <&pwm1m0_pins>;
// 	// pinctrl-0 = <&pwm1m1_pins>;
// };

//&pwm2 {
//	status = "okay";
//	pinctrl-names = "active";
//	pinctrl-0 = <&pwm2m2_pins>;
//};
//&pwm3 {
//	status = "okay";
//	pinctrl-names = "active";
//	pinctrl-0 = <&pwm3m2_pins>;
//};
//&pwm4 {
//	status = "okay";
//	pinctrl-names = "active";
//	pinctrl-0 = <&pwm4m2_pins>;
//};
&pwm5 {
	status = "okay";
	pinctrl-names = "active";
	pinctrl-0 = <&pwm5m1_pins>;
	// pinctrl-0 = <&pwm5m2_pins>;
};
&pwm6 {
	status = "okay";
	pinctrl-names = "active";
	pinctrl-0 = <&pwm6m1_pins>;
	// pinctrl-0 = <&pwm6m2_pins>;
};
//&pwm7 {
//	status = "okay";
//	pinctrl-names = "active";
//	pinctrl-0 = <&pwm7m2_pins>;
//};
//&pwm8 {
//	status = "okay";
//	pinctrl-names = "active";
//	// pinctrl-0 = <&pwm8m1_pins>;
//	pinctrl-0 = <&pwm8m0_pins>;
//};
//&pwm9 {
//	status = "okay";
//	pinctrl-names = "active";
//	// pinctrl-0 = <&pwm9m1_pins>;
//	pinctrl-0 = <&pwm9m0_pins>;
//};

&pwm10 {
	status = "okay";
	pinctrl-names = "active";
	pinctrl-0 = <&pwm10m1_pins>;
	// pinctrl-0 = <&pwm10m2_pins>;
	// pinctrl-0 = <&pwm10m0_pins>;
};
&pwm11 {
	status = "okay";
	pinctrl-names = "active";
	pinctrl-0 = <&pwm11m1_pins>;
	// pinctrl-0 = <&pwm11m2_pins>;
	// pinctrl-0 = <&pwm11m0_pins>;
};


&rtc {
	status = "okay";
};



```





# GPIO

设备目录在/sys/class/gpio /gpio55  

```
GPIO1_C7_d
bank:1
group:2(A=0,D=3)
x:7
引脚编号: 1x32 + (2x8+7)=55
```



设备属性 

```
#    echo 55 > /sys/class/gpio/export
#    cd gpio55
#    ls
value direction edge  ......

1,导出gpio55到用户空间
echo 55 > /sys/class/gpio/export
2,读取 GPIO1_C7_d 引脚电平
echo in > /sys/class/gpio/gpio55/direction
cat /sys/class/gpio/gpio55/value 
3,控制引脚电平
echo out > /sys/class/gpio/gpio55/direction
echo 1 > /sys/class/gpio/gpio55/value
echo 0 > /sys/class/gpio/gpio55/value
4,取消导出
echo 55 > /sys/class/gpio/unexport

```

控制GPIO(c)

```
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
int main()
{
	int gpio_pin;
	printf("please enter the gpio pin number: ");
	scanf("%d",&gpio_pin);
	
	FILE *export_file = fopen("/sys/class/gpio/export","w");
	if(export_file == NULL)
	{
		perror("failed to open GPIO exxport file");
	}
	

}
```



